{"data":{"markdownRemark":{"html":"<p><a href=\"https://doc.rust-lang.org/nomicon/atomics.html\">原子类型</a><br>\n我们可以放心的多线程环境中使用原子类型 但是很明显的要赋予其面对多线程访问时如何处理的信息 </p>\n<h2>Sequentially Consistent (SeqCst)</h2>\n<p>all accesses on one thread that happen before and after a SeqCst access stay before and after it<br>\n序列固化是的编译器不再重排关于这个类型的操作</p>\n<h2>Acquire and Release</h2>\n<p>an acquire access ensures that every access after it stays after it. However operations that occur before an acquire are free to be reordered to occur after it. Similarly, a release access ensures that every access before it stays before it. However operations that occur after a release are free to be reordered to occur before it.<br>\nAcquire 后方固化保证在Acquire之后的操作永远在Acquire之后<br>\nRelease 前方固化保证在Release之前的操作永远在Release之前</p>\n<pre><code class=\"language-rust\">use std::sync::Arc;\nuse std::sync::atomic::{AtomicBool, Ordering};\nuse std::thread;\n\nfn main() {\n    let lock = Arc::new(AtomicBool::new(false)); // value answers \"am I locked?\"\n\n    // ... distribute lock to threads somehow ...\n\n    // Try to acquire the lock by setting it to true\n    while lock.compare_and_swap(false, true, Ordering::Acquire) { }\n    // broke out of the loop, so we successfully acquired the lock!\n\n    // ... scary data accesses ...\n\n    // ok we're done, release the lock\n    lock.store(false, Ordering::Release);\n}\n</code></pre>\n<h2>Relaxed</h2>\n<p>Relaxed accesses are the absolute weakest. They can be freely re-ordered and provide no happens-before relationship. Still, relaxed operations are still atomic. That is, they don't count as data accesses and any read-modify-write operations done to them occur atomically. Relaxed operations are appropriate for things that you definitely want to happen, but don't particularly otherwise care about. For instance, incrementing a counter can be safely done by multiple threads using a relaxed fetch_add if you're not using the counter to synchronize any other accesses.</p>","frontmatter":{"title":""}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/I Want To Talk/rust/atomic/"}}