{"data":{"markdownRemark":{"html":"<h1>install</h1>\n<h2>docker</h2>\n<p>docker run -d -p 9200:9200 elasticsearch:6.5.4</p>\n<h2>docker-compose</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\">  <span class=\"token key atrule\">elasticsearch</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span>  elasticsearch<span class=\"token punctuation\">:</span>5.6.12\n    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"9200:9200\"</span>\n  <span class=\"token key atrule\">kibana</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span>  kibana<span class=\"token punctuation\">:</span>5.6.0\n    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always\n    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">ELASTICSEARCH_HOSTS</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'http://elasticsearch:9200'</span>\n    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token string\">\"5601:5601\"</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>validiate docker</h2>\n<p>curl -u elastic:changeme localhost:9200</p>\n<h1>模型</h1>\n<p>index node shared document type field</p>\n<h2>type是什么</h2>\n<h2>为什么不同的type不能有相同的field</h2>\n<p>正确的将是因为es本身的机制导致相同的field必须是相同的type</p>\n<h2>如何创建一个index</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">POST /<span class=\"token variable\">${index}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h2>list all index</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">GET /_cat/indices?v</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h2>get all doc from index</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">GET  <span class=\"token variable\">${index}</span>/<span class=\"token variable\">${type}</span>/_search \n<span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"query\"</span><span class=\"token keyword\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"match_all\"</span><span class=\"token keyword\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>delete a document</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">DELETE ${index}/${type}/${id} </code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h1>mapping</h1>\n<p>如何ts一样es一样有着类型的问题我们通过post put 等方法将数据丢给es那么其类型是什么? 如果没有显示指定的话es会自己尝试设置类型,同时也可以通过mapping来设置类型</p>\n<h2>获取mapping</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">GET  ${index}/_mapping/${type}</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<h2>how to mapping nest field/array datatype</h2>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-json line-numbers\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n   <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"comments\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nested\"</span><span class=\"token punctuation\">,</span> \n          <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"stars\"</span><span class=\"token operator\">:</span>   <span class=\"token punctuation\">{</span> <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"short\"</span>   <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"date\"</span><span class=\"token operator\">:</span>    <span class=\"token punctuation\">{</span> <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"date\"</span>    <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/guide/master/nested-mapping.html\">nested-mapping</a></p>\n<h1>syntax</h1>\n<h2>aggregation 聚合</h2>\n<h3>nest object</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">GET .market/download_status/_search\n{\n  &quot;aggs&quot;: {\n    &quot;download_status&quot;: {\n      &quot;nested&quot;: {\n        &quot;path&quot;: &quot;detail&quot;\n      },\n      &quot;aggs&quot;: {\n        &quot;download_state&quot;: {\n          &quot;terms&quot;: {\n            &quot;field&quot;: &quot;detail.state&quot;\n          }\n        }\n      }\n    }\n  }\n}</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-nested-aggregation.html\">search-aggregations-bucket-nested-aggregation</a></p>\n<h1>kibana</h1>\n<h2>pipe 饼图</h2>"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/其中的一个齿轮/elasticsearch/"}}