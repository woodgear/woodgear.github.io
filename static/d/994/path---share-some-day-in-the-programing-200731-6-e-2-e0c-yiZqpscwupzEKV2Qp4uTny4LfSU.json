{"data":{"markdownRemark":{"html":"<p>tinykv中在<a href=\"https://github.com/pingcap-incubator/tinykv/blob/2cf41a814468aae405ba860f30fb2ccfc5cc9aad/kv/raftstore/snap/snap.go#L692\"><code class=\"language-text\">opts.DB.IngestExternalFiles(externalFiles)</code></a> 一直卡住 最终追查到<a href=\"https://github.com/Connor1996/badger/blob/9bbcbd8ba570f09f3f2f395b11a6385a14750237/db.go#L913\">badger</a>发现是<code class=\"language-text\">directio.OpenFile</code>使用<code class=\"language-text\">O_DIRECT</code>flag的问题.确定了原因之后找原理就轻松多了.参照<a href=\"https://www.cnblogs.com/renjiashuo/p/7426592.html\">使用go语言绕过page cache读写文件</a></p>\n<h2>update 2020-08-03 10:09:24</h2>\n<p>更加本质的原因是/tmp 目录是tmpfs 而tmpfs本身好像就不是很支持directio<br>\n等价性验证: <code class=\"language-text\">dd if=/dev/zero of=/tmp/myfile bs=1M count=1 oflag=direct</code><br>\n同样也会报错<code class=\"language-text\">dd: failed to open &#39;/tmp/myfile&#39;: Invalid argument</code></p>\n<p>提了个<a href=\"https://github.com/ncw/directio/issues/9\">issue</a></p>","fields":{"slug":"/share/some_day_in_the_programing/200731/","disqus":{"shortname":"woodgear-blog"}},"frontmatter":{"id":"5dde054","time":"2020-07-31T23:42:21+08:00","tag":null},"parent":{"__typename":"File","name":"200731","ext":".md","birthTime":"1970-01-01T00:00:00.000Z","changeTime":"2020-09-26T05:07:21.068Z","relativeDirectory":"share/some_day_in_the_programing","absolutePath":"/home/oaa/ns/share/blog/share/some_day_in_the_programing/200731.md"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/share/some_day_in_the_programing/200731/","disqus":{"shortname":"woodgear-blog"}}}