{"data":{"markdownRemark":{"html":"<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"token keyword\">pub</span> <span class=\"token keyword\">use</span> log<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span><span class=\"token operator\">*</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> log4rs<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span>\n    config<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Config<span class=\"token punctuation\">,</span>\n    file<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">{</span>Deserializers<span class=\"token punctuation\">,</span> RawConfig<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    Logger<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> serde<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Deserialize<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function\">init_log4rs</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span>str<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> Result<span class=\"token operator\">&lt;</span>log4rs<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Handle<span class=\"token punctuation\">,</span> failure<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Error<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> log4rs_config<span class=\"token punctuation\">:</span> RawConfig <span class=\"token operator\">=</span> serde_yaml<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">from_str</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span>?<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">let</span> <span class=\"token punctuation\">(</span>appenders<span class=\"token punctuation\">,</span> _<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> log4rs_config<span class=\"token punctuation\">.</span><span class=\"token function\">appenders_lossy</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>Deserializers<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">default</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">let</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">,</span> _<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> Config<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">appenders</span><span class=\"token punctuation\">(</span>appenders<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">loggers</span><span class=\"token punctuation\">(</span>log4rs_config<span class=\"token punctuation\">.</span><span class=\"token function\">loggers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">build_lossy</span><span class=\"token punctuation\">(</span>log4rs_config<span class=\"token punctuation\">.</span><span class=\"token function\">root</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">Ok</span><span class=\"token punctuation\">(</span>log4rs<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">init_config</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span>?<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">refresh_rate</span><span class=\"token punctuation\">:</span> 30 seconds\n<span class=\"token key atrule\">appenders</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">stdout</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> console\n  <span class=\"token key atrule\">root</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> rolling_file\n    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"log/main.log\"</span>\n    <span class=\"token key atrule\">encoder</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">pattern</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{l} {d(%Y-%m-%d %H:%M:%S)} {T} {M}:{L} - {m}{n}\"</span>\n    <span class=\"token key atrule\">policy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> compound\n      <span class=\"token key atrule\">trigger</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> size\n        <span class=\"token key atrule\">limit</span><span class=\"token punctuation\">:</span> 5 mb\n      <span class=\"token key atrule\">roller</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> delete\n<span class=\"token key atrule\">root</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">level</span><span class=\"token punctuation\">:</span> info\n  <span class=\"token key atrule\">appenders</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> root\n    <span class=\"token punctuation\">-</span> stdout</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"token keyword\">let</span> config <span class=\"token operator\">=</span> <span class=\"token function\">include_str!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"log4rs.yaml\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"config {}\"</span><span class=\"token punctuation\">,</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> log <span class=\"token operator\">=</span> util<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>log<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">init_log4rs</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>","fields":{"slug":"/cube/log4rs-rust/","disqus":{"shortname":"woodgear-blog"}},"frontmatter":{"id":"edrh9td","time":"1996-09-08T23:37:07+08:00","tag":null},"parent":{"__typename":"File","name":"log4rs-rust","ext":".md","birthTime":"1970-01-01T00:00:00.000Z","changeTime":"2020-11-26T15:05:48.114Z","relativeDirectory":"cube","absolutePath":"/home/oaa/sm/ns/share/blog/cube/log4rs-rust.md"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/cube/log4rs-rust/","disqus":{"shortname":"woodgear-blog"}}}