{"data":{"markdownRemark":{"html":"<h1>windows</h1>\n<p>rust 的pdb是兼容windbg的所以平常的调试windows下程序的方法都可以在rust上使用</p>\n<p><a href=\"https://www.forrestthewoods.com/blog/how-to-debug-rust-with-visual-studio-code/\">debug-rust-vscode</a>\nvscode的debug在sourceFileMap上貌似有bug放弃 使用windbg很好用</p>\n<h2>windbg</h2>\n<p><a href=\"https://www.youtube.com/watch?v=ZsrvNtl3enU\">rust-windbbg</a>\n大致步骤如下</p>\n<ol>\n<li>使用对应toolchain的windbg (x86_64-pc-windows-msvc => windbg x86)</li>\n<li>windbg->file->open executable</li>\n<li>set sysmbol file to ./target/debug </li>\n<li>set source file to ./src</li>\n<li>set source file to $HOMEDIR\\rustup\\toolchains\\stable-i686-pc-windows-msvc\\lib\\rustlib\\src\\</li>\n<li>enter .open main.rs</li>\n<li>select line which you want to set breakpoint and press f9</li>\n<li>press g and now you are start to debug</li>\n</ol>\n<p>实际上就是说设置对应的执行文件路径 设置源码路径 当前代码仓库的路径和rust std库的路径 如果引用了第三方库想要debug进去估计也要设置其路径 直接使用<code class=\"language-text\">.open xx</code>命令打开文件 按f9来设置断点就可以了</p>\n<p>或者更简单的方式 直接使用命令行来操作</p>\n<div class=\"gatsby-highlight\" data-language=\"bat\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bat line-numbers\"><code class=\"language-bat\">.srcpath+&quot;xxxx&quot;\nrem list srcpath\n.srcpath\n\n.sympath+&quot;xxxx&quot;\nrem list srcpath\n.sympath</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2>attach a running rust program</h2>\n<p>在windbg中使用attach to process即可,后面的设置和上面一样 </p>\n<h2>attach a rust program when it start</h2>\n<p><a href=\"https://support.microsoft.com/en-us/help/824344/how-to-debug-windows-services\">how-to-debug-windows-services</a>\n与通过windbg直接启动程序 和 attach到一个已经运行的程序不同 这次我们希望能够在程序启动时自动的attach上去.<br>\n理论上讲上面链接的方法都是可用的 但是在真正尝试时 gflags的方法并没有生效 改注册表的方法是可用的</p>\n<div class=\"gatsby-highlight\" data-language=\"bat\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bat line-numbers\"><code class=\"language-bat\">rem REG ADD &quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\${NAME}.exe&quot; /v Debugger  /t REG_SZ /d &quot;${WINDBG_FULLPATH}&quot;\n\nREG ADD &quot;HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\test-debug.exe&quot; /v Debugger  /t REG_SZ /d &quot;C:\\Program Files (x86)\\Windows Kits\\10\\Debuggers\\x86\\windbg.exe&quot;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<h2>c project static link rust program</h2>\n<p>使用windbg同上 只不过也要配置C项目的符号和源码路径</p>","fields":{"slug":"/share/rust-debug/","disqus":{"shortname":"woodgear-blog"}},"frontmatter":{"id":"n2ctkee","time":"1996-09-08T23:37:07+08:00","tag":null},"parent":{"__typename":"File","name":"rust-debug","ext":".md","birthTime":"2020-08-12T15:37:07.077Z","changeTime":"2020-08-12T17:06:41.413Z","relativeDirectory":"share","absolutePath":"/home/oaa/temp/blog/share/rust-debug.md"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/share/rust-debug/","disqus":{"shortname":"woodgear-blog"}}}