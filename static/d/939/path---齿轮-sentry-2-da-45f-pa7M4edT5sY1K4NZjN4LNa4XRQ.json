{"data":{"markdownRemark":{"html":"<h1>是什么</h1>\n<p>很明显 sentry 是一个日志收集与分析系统(俺觉得是),那么当我们将我们想要去了解如何使用 sentry 时我们实际上是在想如何让 sentry 帮我们收集分析日志.\n所以 sentry 的文档应当告诉我们</p>\n<ol>\n<li>如何把日志报上去</li>\n<li>如何分析这些日志</li>\n<li>sentry 是如何工作的(从开发者视角看了)</li>\n</ol>\n<h1>如何上报</h1>\n<h2>模型</h2>\n<p>sentry 作为一个被集成在应用中,log 时调用 sentry 的 API 发送请求,然后在 sentry 的控制台(网页)上做分析</p>\n<h2>所指向之物</h2>\n<p>Q:\n无论如何我们需要标识 logger 自身,不同的人/程序 使用 sentry 必须要区别开来\nA:\nsentry 提供了<a href=\"https://docs.sentry.io/error-reporting/quickstart/?platform=rust\">DSN</a></p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"token attribute attr-name\">#[macro_use]</span>\n<span class=\"token keyword\">extern</span> <span class=\"token keyword\">crate</span> log<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">use</span> pretty_env_logger<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> sentry<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">fn</span> <span class=\"token function\">init_log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> _guard <span class=\"token operator\">=</span> sentry<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"https://b91b96b0b6304d3a8c8dc44eab1bf965@sentry.io/479965\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> log_builder <span class=\"token operator\">=</span> pretty_env_logger<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">formatted_builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    log_builder<span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"info\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// or env::var(\"RUST_LOG\")</span>\n    <span class=\"token keyword\">let</span> logger <span class=\"token operator\">=</span> log_builder<span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> options <span class=\"token operator\">=</span> sentry<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>integrations<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>log<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>LoggerOptions <span class=\"token punctuation\">{</span>\n        global_filter<span class=\"token punctuation\">:</span> <span class=\"token function\">Some</span><span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">..</span>Default<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">default</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    sentry<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>integrations<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>log<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token function\">Some</span><span class=\"token punctuation\">(</span>Box<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fn</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">init_log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">error!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"some log\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如上 你就可以将日志上报至 sentry</p>\n<h2>分析与聚合</h2>\n<p>现在我们有能力将日志上传至 sentry,但日志实际上就只是字符串的流而已,我么们要想办法从中做出区分,用 sentry 的术语就是要能够从 Event 中聚类出 Issue,即 <a href=\"https://docs.sentry.io/data-management/rollups/?platform=rust\">Rollups &#x26; Grouping</a></p>\n<h3>sentry style</h3>"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/齿轮/sentry/"}}