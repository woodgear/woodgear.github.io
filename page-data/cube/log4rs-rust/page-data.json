{"componentChunkName":"component---src-templates-blog-post-js","path":"/cube/log4rs-rust/","result":{"data":{"markdownRemark":{"html":"<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"token keyword\">pub</span> <span class=\"token keyword\">use</span> <span class=\"token namespace\">log<span class=\"token punctuation\">::</span></span><span class=\"token punctuation\">{</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">,</span><span class=\"token operator\">*</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token namespace\">log4rs<span class=\"token punctuation\">::</span></span><span class=\"token punctuation\">{</span>\n    <span class=\"token namespace\">config<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">Config</span><span class=\"token punctuation\">,</span>\n    <span class=\"token namespace\">file<span class=\"token punctuation\">::</span></span><span class=\"token punctuation\">{</span><span class=\"token class-name\">Deserializers</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">RawConfig</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token class-name\">Logger</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token namespace\">serde<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">Deserialize</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">pub</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">init_log4rs</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token keyword\">str</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token class-name\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token namespace\">log4rs<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">Handle</span><span class=\"token punctuation\">,</span> <span class=\"token namespace\">failure<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">Error</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> log4rs_config<span class=\"token punctuation\">:</span> <span class=\"token class-name\">RawConfig</span> <span class=\"token operator\">=</span> <span class=\"token namespace\">serde_yaml<span class=\"token punctuation\">::</span></span><span class=\"token function\">from_str</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">let</span> <span class=\"token punctuation\">(</span>appenders<span class=\"token punctuation\">,</span> _<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> log4rs_config<span class=\"token punctuation\">.</span><span class=\"token function\">appenders_lossy</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token class-name\">Deserializers</span><span class=\"token punctuation\">::</span><span class=\"token function\">default</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">let</span> <span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">,</span> _<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">Config</span><span class=\"token punctuation\">::</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">appenders</span><span class=\"token punctuation\">(</span>appenders<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">loggers</span><span class=\"token punctuation\">(</span>log4rs_config<span class=\"token punctuation\">.</span><span class=\"token function\">loggers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">build_lossy</span><span class=\"token punctuation\">(</span>log4rs_config<span class=\"token punctuation\">.</span><span class=\"token function\">root</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">Ok</span><span class=\"token punctuation\">(</span><span class=\"token namespace\">log4rs<span class=\"token punctuation\">::</span></span><span class=\"token function\">init_config</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token operator\">?</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-yaml line-numbers\"><code class=\"language-yaml\"><span class=\"token key atrule\">refresh_rate</span><span class=\"token punctuation\">:</span> 30 seconds\n<span class=\"token key atrule\">appenders</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">stdout</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> console\n  <span class=\"token key atrule\">root</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> rolling_file\n    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"log/main.log\"</span>\n    <span class=\"token key atrule\">encoder</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">pattern</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"{l} {d(%Y-%m-%d %H:%M:%S)} {T} {M}:{L} - {m}{n}\"</span>\n    <span class=\"token key atrule\">policy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> compound\n      <span class=\"token key atrule\">trigger</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> size\n        <span class=\"token key atrule\">limit</span><span class=\"token punctuation\">:</span> 5 mb\n      <span class=\"token key atrule\">roller</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> delete\n<span class=\"token key atrule\">root</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">level</span><span class=\"token punctuation\">:</span> info\n  <span class=\"token key atrule\">appenders</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> root\n    <span class=\"token punctuation\">-</span> stdout</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-rust line-numbers\"><code class=\"language-rust\"><span class=\"token keyword\">let</span> config <span class=\"token operator\">=</span> <span class=\"token macro property\">include_str!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"log4rs.yaml\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"config {}\"</span><span class=\"token punctuation\">,</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> log <span class=\"token operator\">=</span> <span class=\"token namespace\">util<span class=\"token punctuation\">::</span>log<span class=\"token punctuation\">::</span></span><span class=\"token function\">init_log4rs</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>","fields":{"slug":"/cube/log4rs-rust/","disqus":{"shortname":"woodgear-blog"}},"frontmatter":{"id":"edrh9td","time":"1996-09-08T23:37:07+08:00","tag":null},"parent":{"__typename":"File","name":"log4rs-rust","ext":".md","birthTime":"2020-03-21T15:26:01.289Z","changeTime":"2020-08-17T01:18:00.575Z","relativeDirectory":"cube","absolutePath":"C:/Users/18754/ns/share/blog/cube/log4rs-rust.md"}}},"pageContext":{"slug":"/cube/log4rs-rust/","disqus":{"shortname":"woodgear-blog"}}},"staticQueryHashes":["68354608"]}